<div class="bg-white rounded-lg shadow-sm p-6">
  <div class="flex justify-between items-center mb-6">
    <div>
      <h2 class="text-2xl font-bold">Available Appointments</h2>
      <p class="text-gray-600 mt-1"><%= office.name %> - <%= office.time_zone %></p>
    </div>

    <!-- Week Navigation -->
    <div class="flex gap-2">
      <%= link_to "← Previous",
          public_profile_path(provider.slug, office_id: office.id, week: (availability[:week_start] - 7.days).iso8601),
          class: "px-4 py-2 bg-gray-100 rounded hover:bg-gray-200" %>
      <%= link_to "Next →",
          public_profile_path(provider.slug, office_id: office.id, week: (availability[:week_start] + 7.days).iso8601),
          class: "px-4 py-2 bg-gray-100 rounded hover:bg-gray-200" %>
    </div>
  </div>

  <!-- Week Grid -->
  <% if availability[:slots_by_day].present? %>
    <div class="grid grid-cols-7 gap-2">
      <% availability[:week_start].upto(availability[:week_end]) do |date| %>
        <div class="border rounded-lg p-3">
          <div class="font-semibold mb-2 text-center">
            <%= date.strftime("%a") %><br>
            <span class="text-sm text-gray-600"><%= date.strftime("%m/%d") %></span>
          </div>

          <div class="space-y-1">
            <% slots = availability[:slots_by_day][date] || [] %>
            <% if slots.any? %>
              <% slots.each do |slot| %>
                <% if slot.status == "available" %>
                  <% if can_book %>
                    <%= link_to new_booking_path(provider.slug,
                          office_id: office.id,
                          slot_start: slot.start_time.iso8601,
                          slot_end: slot.end_time.iso8601),
                        class: "block text-xs p-2 bg-green-50 border border-green-400 text-green-800 rounded hover:bg-green-100 text-center transition-colors" do %>
                      <%= slot.start_time.strftime("%H:%M") %>
                    <% end %>
                  <% else %>
                    <div class="text-xs p-2 bg-green-50 border border-green-400 text-green-800 rounded text-center">
                      <%= slot.start_time.strftime("%H:%M") %>
                    </div>
                  <% end %>
                <% else %>
                  <div class="text-xs p-2 bg-gray-100 border border-gray-300 text-gray-600 rounded text-center">
                    <%= slot.start_time.strftime("%H:%M") %>
                  </div>
                <% end %>
              <% end %>
            <% else %>
              <div class="text-xs text-gray-400 text-center py-2">
                Closed
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-8 text-gray-500">
      No availability information for this week.
    </div>
  <% end %>

  <!-- Sign in prompt for anonymous users -->
  <% unless can_book %>
    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
      <p class="text-blue-900 mb-3">
        <strong>Want to book an appointment?</strong>
      </p>
      <%= link_to "Sign in", new_user_session_path,
          class: "inline-block px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 mr-2" %>
      <%= link_to "Create account", new_user_registration_path,
          class: "inline-block px-6 py-2 bg-white border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50" %>
    </div>
  <% end %>

  <!-- Legend -->
  <div class="mt-6 flex gap-4 justify-center text-sm">
    <div class="flex items-center gap-2">
      <div class="w-4 h-4 bg-green-50 border border-green-400 rounded"></div>
      <span>Available</span>
    </div>
    <div class="flex items-center gap-2">
      <div class="w-4 h-4 bg-gray-100 border border-gray-300 rounded"></div>
      <span>Booked</span>
    </div>
  </div>

  <!-- Stats Summary -->
  <% if availability[:total_slots] && availability[:total_slots] > 0 %>
    <div class="mt-6 pt-6 border-t border-gray-200">
      <div class="grid grid-cols-3 gap-4 text-center">
        <div>
          <div class="text-2xl font-bold text-gray-900"><%= availability[:total_slots] %></div>
          <div class="text-sm text-gray-600">Total Slots</div>
        </div>
        <div>
          <div class="text-2xl font-bold text-green-600"><%= availability[:available_slots] %></div>
          <div class="text-sm text-gray-600">Available</div>
        </div>
        <div>
          <div class="text-2xl font-bold text-red-600"><%= availability[:total_slots] - availability[:available_slots] %></div>
          <div class="text-sm text-gray-600">Booked</div>
        </div>
      </div>
    </div>
  <% end %>
</div>
