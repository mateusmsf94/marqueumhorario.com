<%#
  Partial for one day's schedule section.
  Includes toggle checkbox, work period inputs, and appointment settings.
  Uses Stimulus for dynamic show/hide and add/remove period functionality.

  Local variables:
    - day_name: Symbol like :monday
    - day_number: Integer 0-6
    - schedule: WorkSchedule instance for this day %>

  <div
    class="bg-white shadow rounded-lg p-6"
    id="day-<%= day_name %>"
    data-controller="work-periods"
    data-work-periods-day-value="<%= day_number %>"
  >

    <%# Day Header with Toggle Checkbox %>
    <div
      class="
        flex items-center justify-between mb-4 pb-4 border-b border-gray-200
      "
    >
      <h3 class="text-lg font-medium text-gray-900">
        <%= day_name.to_s.capitalize %>
      </h3>

      <label class="flex items-center cursor-pointer">
        <%= check_box_tag "schedules[#{day_number}][is_open]",
        "1",
        schedule.is_active,
        class: "rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2",
        data: {
          action: "work-periods#toggleDay",
        } %>
        <span class="text-sm font-medium text-gray-700">Open this day</span>
      </label>
    </div>

    <%# Day Inputs Container (shown/hidden based on checkbox) %>
    <div
      data-work-periods-target="inputs"
      style="<%= 'display: none;' unless schedule.is_active %>"
      class="space-y-4"
    >

      <%# Work Periods Section %>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-3">
          Working Hours
        </label>

        <%# Container for work period inputs (Stimulus manages this) %>
        <div data-work-periods-target="container" class="space-y-2">
          <% periods = schedule.work_periods || [{ "start" => "09:00", "end" => "17:00" }] %>
          <% periods.each_with_index do |period, index| %>
            <%= render "work_period", day_number: day_number, period: period, index: index %>
          <% end %>
        </div>

        <%# Button to add another work period (managed by Stimulus) %>
        <button
          type="button"
          data-action="work-periods#addPeriod"
          class="
            mt-3 inline-flex items-center text-sm text-blue-600 hover:text-blue-800
            font-medium
          "
        >
          <svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4v16m8-8H4"
            />
          </svg>
          Add another time period
        </button>
      </div>

      <%# Appointment Settings Section %>
      <div
        class="
          grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-200
        "
      >
        <%# Appointment Duration %>
        <div>
          <%= label_tag "schedules[#{day_number}][appointment_duration_minutes]",
          "Appointment Duration",
          class: "block text-sm font-medium text-gray-700 mb-1" %>
          <div class="flex items-center">
            <%= number_field_tag "schedules[#{day_number}][appointment_duration_minutes]",
            schedule.appointment_duration_minutes || 60,
            min: 5,
            max: 480,
            step: 5,
            class:
              "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
            <span class="ml-2 text-sm text-gray-500">minutes</span>
          </div>
          <p class="mt-1 text-xs text-gray-500">How long each appointment lasts</p>
        </div>

        <%# Buffer Time %>
        <div>
          <%= label_tag "schedules[#{day_number}][buffer_minutes_between_appointments]",
          "Buffer Time",
          class: "block text-sm font-medium text-gray-700 mb-1" %>
          <div class="flex items-center">
            <%= number_field_tag "schedules[#{day_number}][buffer_minutes_between_appointments]",
            schedule.buffer_minutes_between_appointments || 15,
            min: 0,
            max: 120,
            step: 5,
            class:
              "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
            <span class="ml-2 text-sm text-gray-500">minutes</span>
          </div>
          <p class="mt-1 text-xs text-gray-500">Break between appointments</p>
        </div>
      </div>

      <%# Validation Errors for This Day %>
      <% if schedule.errors.any? %>
        <div class="mt-3 bg-red-50 border border-red-200 rounded-md p-3">
          <div class="text-sm text-red-600">
            <% schedule.errors.full_messages.each do |msg| %>
              <p>â€¢
                <%= msg %></p>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

